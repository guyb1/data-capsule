{"version":3,"sources":["webpack:///webpack/bootstrap 04a84cd9e81c6067b598","webpack:///./base-storage.js","webpack:///./utils/constants.js","webpack:///../node_modules/greedy-split/dist/src/index.js","webpack:///./frame.js","webpack:///./data-capsule.js","webpack:///./strategies/frame-storage.js"],"names":["BaseStorage","forEach","method","prototype","Error","key","value","options","strategy","module","exports","errors","NOT_FOUND","SERVER_ERROR","toError","str","Object","values","find","err","message","PREFIX_SEPARATOR","KEY_SEPARATOR","STORAGE_PREFIX","FrameStorageStrategy","require","DataCapsule","validateNamespace","namespace","buildValidadateOptions","capsuleOptions","assign","scope","storageStrategy","verify","_options","setItem","getItem","removeItem","getAllItems","greedySplit","pending","sendCommand","params","id","Date","now","Math","random","token","JSON","stringify","join","target","postMessage","origin","Promise","resolve","reject","reason","readCommands","window","addEventListener","e","data","parse","undefined"],"mappings":"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","file":"frame.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t__webpack_require__.p = typeof window !== 'undefined' && window.__STATICS_BASE_URL__ || __webpack_require__.p;\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 39);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 04a84cd9e81c6067b598","'use strict';\n\nclass BaseStorage {\n  constructor() {\n    ['setItem', 'getItem', 'removeItem', 'getAllItems'].forEach(method => {\n      if (this[method] === BaseStorage.prototype[method]) {\n        throw new Error(`BaseStorage method [${method}] must be overriden!`);\n      }\n    });\n  }\n\n  setItem(key, value, options) {\n    throw options;\n  }\n\n  getItem(key, options) {\n    throw options;\n  }\n\n  removeItem(key, options) {\n    throw options;\n  }\n\n  getAllItems(options) {\n    throw options;\n  }\n\n  static verify(strategy) {\n    if (strategy instanceof BaseStorage) {\n      return strategy;\n    } else {\n      throw new Error(`This class must extend BaseStorage!`);\n    }\n  }\n}\n\nmodule.exports = BaseStorage;\n\n\n\n// WEBPACK FOOTER //\n// ./base-storage.js","const errors = {\n  NOT_FOUND: new Error('Key was not found in capsule'),\n  SERVER_ERROR: new Error('Failed to perform operarion on server')\n};\n\nfunction toError(str) {\n  return Object.values(errors).find(err => err.message === str) || str;\n}\n\nmodule.exports = {\n  PREFIX_SEPARATOR: '|',\n  KEY_SEPARATOR: '#',\n  STORAGE_PREFIX: 'capsule',\n  NOT_FOUND: errors.NOT_FOUND,\n  SERVER_ERROR: errors.SERVER_ERROR,\n  toError\n};\n\n\n\n// WEBPACK FOOTER //\n// ./utils/constants.js","'use strict';\n\nfunction greedySplit(str, separator, limit) {\n  var result = str.split(separator, limit);\n  if (result.length === limit) {\n    var length = 0;\n    if (typeof separator === 'string') {\n      length = result.join(separator).length;\n    } else {\n      length = result.reduce(function (l, x, i) {\n        var separatorLength = 0;\n        if (i + 1 < limit) {\n          separatorLength = str.slice(l).match(separator).shift().length;\n        }\n        return l + x.length + separatorLength;\n      }, 0);\n    }\n    result[limit - 1] += str.slice(length);\n  }\n  return result;\n}\n\nmodule.exports = greedySplit;\n//# sourceMappingURL=index.js.map\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/greedy-split/dist/src/index.js\n// module id = 3\n// module chunks = 0 1 2","'use strict';\n\nconst FrameStorageStrategy = require('./strategies/frame-storage');\nconst {NOT_FOUND} = require('./utils/constants');\nconst BaseStorage = require('./base-storage');\nconst DataCapsule = require('./data-capsule');\n\nmodule.exports = {\n  NOT_FOUND,\n  BaseStorage,\n  DataCapsule,\n  FrameStorageStrategy\n};\n\n\n\n// WEBPACK FOOTER //\n// ./frame.js","'use strict';\n\nconst BaseStorage = require('./base-storage');\n\nfunction validateNamespace(options) {\n  if (!options.namespace) {\n    throw new Error('namespace is required');\n  } else if (typeof options.namespace !== 'string') {\n    throw new Error('namespace should be a string');\n  }\n}\n\nfunction buildValidadateOptions(capsuleOptions, options) {\n  options = Object.assign({}, capsuleOptions, options);\n  validateNamespace(options);\n  return options;\n}\n\nclass DataCapsule extends BaseStorage {\n  constructor({strategy, namespace, scope}) {\n    super();\n    this.storageStrategy = BaseStorage.verify(strategy);\n    this._options = {namespace, scope};\n  }\n\n\n  setItem(key, value, options) {\n    options = buildValidadateOptions(this._options, options);\n    return this.storageStrategy.setItem(key, value, options);\n  }\n\n  getItem(key, options) {\n    options = buildValidadateOptions(this._options, options);\n    return this.storageStrategy.getItem(key, options);\n  }\n\n  removeItem(key, options) {\n    options = buildValidadateOptions(this._options, options);\n    return this.storageStrategy.removeItem(key, options);\n  }\n\n  getAllItems(options) {\n    options = buildValidadateOptions(this._options, options);\n    return this.storageStrategy.getAllItems(options);\n  }\n}\n\nmodule.exports = DataCapsule;\n\n\n\n// WEBPACK FOOTER //\n// ./data-capsule.js","/* global window */\n'use strict';\n\nconst greedySplit = require('greedy-split');\nconst BaseStorage = require('../base-storage');\nconst {STORAGE_PREFIX, toError} = require('../utils/constants');\nconst pending = {};\n\nfunction sendCommand(method, params, options) {\n  const id = `${Date.now()}-${Math.random()}`;\n  const message = [STORAGE_PREFIX, options.token, id, method, JSON.stringify(params)].join('|');\n  options.target.postMessage(message, options.origin);\n  return new Promise((resolve, reject) => {\n    pending[id] = {resolve, reject: reason => reject(toError(reason))};\n  });\n}\n\nfunction readCommands(options) {\n  window.addEventListener('message', e => {\n    const [target, token, id, method, params] = greedySplit(e.data, '|', 5);\n    if (target === STORAGE_PREFIX + 'Done' && token === options.token) {\n      pending[id][method](params ? JSON.parse(params) : undefined);\n      delete pending[id];\n    }\n  }, true);\n}\n\nclass FrameStorageStrategy extends BaseStorage {\n  constructor(target, origin, token) {\n    super();\n    this._options = {target, origin, token};\n    readCommands(this._options);\n  }\n\n  setItem(...params) {\n    return sendCommand('setItem', params, this._options);\n  }\n\n  getItem(...params) {\n    return sendCommand('getItem', params, this._options);\n  }\n\n  removeItem(...params) {\n    return sendCommand('removeItem', params, this._options);\n  }\n\n  getAllItems(...params) {\n    return sendCommand('getAllItems', params, this._options);\n  }\n}\n\nmodule.exports = FrameStorageStrategy;\n\n\n\n// WEBPACK FOOTER //\n// ./strategies/frame-storage.js"],"sourceRoot":""}